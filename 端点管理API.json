{
  "info": {
    "title": "epipremnum - 端点管理 API",
    "description": "Ollama端点管理接口文档，支持端点的创建、查询、更新、测试和删除等功能",
    "version": "2.0.0"
  },
  "openapi": "3.0.0",
  "servers": [
    {
      "url": "http://192.168.55.133:8888",
      "description": "生产环境"
    }
  ],
  "paths": {
    "/api/ollama/endpoint/": {
      "get": {
        "summary": "获取端点列表",
        "description": "获取所有Ollama端点列表，包含端点配置和状态信息",
        "tags": ["端点管理 API"],
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token 认证",
            "required": true,
            "example": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
            "schema": {"type": "string"}
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取端点列表",
            "content": {
              "application/json": {
                "example": {
                  "code": 200,
                  "message": "获取端点列表成功",
                  "data": {
                    "endpoints": [
                      {
                        "id": 1,
                        "name": "默认Ollama端点",
                        "url": "http://115.190.140.100:31434",
                        "description": "默认的Ollama服务端点",
                        "is_active": true,
                        "is_default": true,
                        "timeout": 300,
                        "created_by": 1,
                        "created_by_username": "admin",
                        "created_at": "2025-01-20T10:00:00Z",
                        "updated_at": "2025-01-20T10:00:00Z"
                      }
                    ],
                    "total": 1
                  }
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "example": {
                  "code": 401,
                  "message": "认证失败",
                  "data": null
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "创建新端点",
        "description": "创建新的Ollama服务端点配置",
        "tags": ["端点管理 API"],
        "parameters": [
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token 认证",
            "required": true,
            "example": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
            "schema": {"type": "string"}
          },
          {
            "name": "Content-Type",
            "in": "header",
            "description": "请求内容类型",
            "required": true,
            "example": "application/json",
            "schema": {"type": "string"}
          }
        ],
        "requestBody": {
          "description": "创建端点参数",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["name", "url"],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "端点名称",
                    "example": "本地Ollama服务"
                  },
                  "url": {
                    "type": "string",
                    "format": "uri",
                    "description": "端点URL",
                    "example": "http://115.190.140.100:31434"
                  },
                  "description": {
                    "type": "string",
                    "description": "端点描述（可选）",
                    "example": "本地的Ollama服务"
                  },
                  "is_default": {
                    "type": "boolean",
                    "description": "是否设为默认端点（可选）",
                    "example": false
                  },
                  "timeout": {
                    "type": "integer",
                    "description": "超时时间（秒，可选）",
                    "example": 300
                  }
                }
              },
              "example": {
                "name": "本地Ollama服务",
                "url": "http://115.190.140.100:31434",
                "description": "本地的Ollama服务",
                "timeout": 300
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "成功创建端点",
            "content": {
              "application/json": {
                "example": {
                  "code": 200,
                  "message": "端点创建成功",
                  "data": {
                    "id": 2,
                    "name": "本地Ollama服务",
                    "url": "http://115.190.140.100:31434",
                    "description": "本地的Ollama服务",
                    "is_active": true,
                    "is_default": false,
                    "timeout": 300,
                    "created_by": 1,
                    "created_by_username": "admin",
                    "created_at": "2025-01-20T10:30:00Z",
                    "updated_at": "2025-01-20T10:30:00Z"
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "example": {
                  "code": 400,
                  "message": "端点名称和URL不能为空",
                  "data": null
                }
              }
            }
          }
        }
      }
    },
    "/api/ollama/endpoint/{id}/": {
      "get": {
        "summary": "获取端点详情",
        "description": "获取指定端点的详细信息",
        "tags": ["端点管理 API"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "端点ID",
            "schema": {"type": "integer"},
            "example": 1
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token 认证",
            "required": true,
            "example": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
            "schema": {"type": "string"}
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取端点详情",
            "content": {
              "application/json": {
                "example": {
                  "code": 200,
                  "message": "获取端点详情成功",
                  "data": {
                    "id": 1,
                    "name": "默认Ollama端点",
                    "url": "http://115.190.140.100:31434",
                    "description": "默认的Ollama服务端点",
                    "is_active": true,
                    "is_default": true,
                    "timeout": 300,
                    "created_by": 1,
                    "created_by_username": "admin",
                    "created_at": "2025-01-20T10:00:00Z",
                    "updated_at": "2025-01-20T10:00:00Z"
                  }
                }
              }
            }
          },
          "404": {
            "description": "端点不存在",
            "content": {
              "application/json": {
                "example": {
                  "code": 404,
                  "message": "端点不存在",
                  "data": null
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "更新端点",
        "description": "更新指定端点的配置信息",
        "tags": ["端点管理 API"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "端点ID",
            "schema": {"type": "integer"},
            "example": 1
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token 认证",
            "required": true,
            "example": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
            "schema": {"type": "string"}
          },
          {
            "name": "Content-Type",
            "in": "header",
            "description": "请求内容类型",
            "required": true,
            "example": "application/json",
            "schema": {"type": "string"}
          }
        ],
        "requestBody": {
          "description": "更新端点参数",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "端点名称",
                    "example": "更新后的端点名称"
                  },
                  "url": {
                    "type": "string",
                    "format": "uri",
                    "description": "端点URL",
                    "example": "http://115.190.140.100:31434"
                  },
                  "description": {
                    "type": "string",
                    "description": "端点描述",
                    "example": "更新后的描述"
                  },
                  "is_active": {
                    "type": "boolean",
                    "description": "是否激活",
                    "example": true
                  },
                  "is_default": {
                    "type": "boolean",
                    "description": "是否设为默认端点",
                    "example": false
                  },
                  "timeout": {
                    "type": "integer",
                    "description": "超时时间（秒）",
                    "example": 300
                  }
                }
              },
              "example": {
                "name": "更新后的端点名称",
                "url": "http://115.190.140.100:31434",
                "description": "更新后的描述",
                "is_active": true,
                "timeout": 300
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功更新端点",
            "content": {
              "application/json": {
                "example": {
                  "code": 200,
                  "message": "端点更新成功",
                  "data": {
                    "id": 1,
                    "name": "更新后的端点名称",
                    "url": "http://115.190.140.100:31434",
                    "description": "更新后的描述",
                    "is_active": true,
                    "is_default": false,
                    "timeout": 300,
                    "created_by": 1,
                    "created_by_username": "admin",
                    "created_at": "2025-01-20T10:00:00Z",
                    "updated_at": "2025-01-20T10:35:00Z"
                  }
                }
              }
            }
          },
          "403": {
            "description": "权限不足",
            "content": {
              "application/json": {
                "example": {
                  "code": 403,
                  "message": "只有创建者可以修改端点配置",
                  "data": null
                }
              }
            }
          },
          "404": {
            "description": "端点不存在",
            "content": {
              "application/json": {
                "example": {
                  "code": 404,
                  "message": "端点不存在",
                  "data": null
                }
              }
            }
          }
        }
      }
    },
    "/api/ollama/endpoint/{id}/test/": {
      "get": {
        "summary": "测试端点连接",
        "description": "测试指定端点的连接状态和可用性",
        "tags": ["端点管理 API"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "端点ID",
            "schema": {"type": "integer"},
            "example": 1
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token 认证",
            "required": true,
            "example": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
            "schema": {"type": "string"}
          }
        ],
        "responses": {
          "200": {
            "description": "成功测试端点连接",
            "content": {
              "application/json": {
                "example": {
                  "code": 200,
                  "message": "端点连接测试成功",
                  "data": {
                    "success": true,
                    "models_count": 5,
                    "models": ["qwen3-vl:2b-instruct-bf16", "llava:7b", "mixtral:8x7b", "codellama:7b", "phi3:3.8b"],
                    "response_time": 1.23,
                    "test_time": "2025-01-20T10:30:00Z"
                  }
                }
              }
            }
          },
          "404": {
            "description": "端点不存在",
            "content": {
              "application/json": {
                "example": {
                  "code": 404,
                  "message": "端点不存在",
                  "data": null
                }
              }
            }
          },
          "500": {
            "description": "连接测试失败",
            "content": {
              "application/json": {
                "example": {
                  "code": 500,
                  "message": "端点连接测试失败",
                  "data": {
                    "success": false,
                    "error": "Connection timeout"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/ollama/endpoint/{id}/delete/": {
      "post": {
        "summary": "删除端点",
        "description": "删除指定的Ollama端点配置",
        "tags": ["端点管理 API"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "端点ID",
            "schema": {"type": "integer"},
            "example": 1
          },
          {
            "name": "Authorization",
            "in": "header",
            "description": "Bearer token 认证",
            "required": true,
            "example": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
            "schema": {"type": "string"}
          },
          {
            "name": "Content-Type",
            "in": "header",
            "description": "请求内容类型",
            "required": true,
            "example": "application/json",
            "schema": {"type": "string"}
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              },
              "example": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功删除端点",
            "content": {
              "application/json": {
                "example": {
                  "code": 200,
                  "message": "端点删除成功",
                  "data": null
                }
              }
            }
          },
          "403": {
            "description": "权限不足",
            "content": {
              "application/json": {
                "example": {
                  "code": 403,
                  "message": "只有创建者或超级用户可以删除端点",
                  "data": null
                }
              }
            }
          },
          "404": {
            "description": "端点不存在",
            "content": {
              "application/json": {
                "example": {
                  "code": 404,
                  "message": "端点不存在",
                  "data": null
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "端点管理 API",
      "description": "Ollama端点管理相关接口，包括端点的创建、查询、更新、测试和删除等功能"
    }
  ]
}